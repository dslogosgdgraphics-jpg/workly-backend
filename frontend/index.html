<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workly - Employee Attendance & Payroll Management</title>
    <meta name="description" content="Simple and powerful attendance and payroll management system for small businesses">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
        .hidden { display: none !important; }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .sidebar { transition: transform 0.3s ease; }
        @media (max-width: 768px) {
            .sidebar { transform: translateX(-100%); position: fixed; }
            .sidebar.active { transform: translateX(0); }
        }
        .toast { position: fixed; top: 20px; right: 20px; z-index: 9999; max-width: 400px; }
        .modal-backdrop { background: rgba(0,0,0,0.5); }
        .stat-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .stat-card-2 { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .stat-card-3 { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .stat-card-4 { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
        .loading { border: 3px solid #f3f4f6; border-top: 3px solid #3b82f6; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .nav-item.active { background: #dbeafe; color: #1e40af; font-weight: 600; }
        table { width: 100%; border-collapse: collapse; }
        th { background: #f9fafb; font-weight: 600; text-align: left; }
        tbody tr:hover { background: #f9fafb; }
    </style>
</head>
<body class="bg-gray-50">

<!-- Toast Container -->
<div id="toastContainer" class="toast"></div>

<!-- Loading Overlay -->
<div id="loadingOverlay" class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-lg p-6 shadow-xl">
        <div class="loading"></div>
        <p class="text-center mt-4 text-gray-700 font-medium">Loading...</p>
    </div>
</div>

<!-- ==================== AUTH SCREEN ==================== -->
<div id="authScreen" class="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-500 via-purple-500 to-pink-500 p-4">
    <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md fade-in">
        <div class="text-center mb-8">
            <div class="inline-block bg-blue-100 rounded-full p-4 mb-4">
                <svg class="w-12 h-12 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                </svg>
            </div>
            <h1 class="text-4xl font-bold text-gray-800 mb-2">Workly</h1>
            <p class="text-gray-600">Attendance & Payroll Management</p>
        </div>
        
        <!-- Login Form -->
        <div id="loginFormContainer">
            <h2 class="text-2xl font-bold mb-6 text-gray-800">Sign In</h2>
            <form id="loginForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Email Address</label>
                    <input type="email" id="loginEmail" required 
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" 
                        placeholder="your@email.com">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                    <input type="password" id="loginPassword" required 
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" 
                        placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition duration-200 shadow-lg">
                    Sign In
                </button>
            </form>
            <p class="text-center mt-6 text-sm text-gray-600">
                Don't have an account? 
                <button onclick="showRegisterForm()" class="text-blue-600 hover:text-blue-700 font-semibold">Create Company Account</button>
            </p>
            <div class="mt-6 p-4 bg-blue-50 rounded-lg border border-blue-200">
                <p class="text-xs text-blue-800 font-semibold mb-2">Demo Account:</p>
                <p class="text-xs text-blue-700">üìß admin@workly.com</p>
                <p class="text-xs text-blue-700">üîë admin123</p>
            </div>
        </div>
        
        <!-- Register Form -->
        <div id="registerFormContainer" class="hidden">
            <h2 class="text-2xl font-bold mb-6 text-gray-800">Register Your Company</h2>
            <form id="registerForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Company Name</label>
                    <input type="text" id="regCompanyName" required 
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Company Email</label>
                    <input type="email" id="regCompanyEmail" required 
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Your Name (Admin)</label>
                    <input type="text" id="regAdminName" required 
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Your Email</label>
                    <input type="email" id="regAdminEmail" required 
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Password (min. 6 characters)</label>
                    <input type="password" id="regPassword" required minlength="6" 
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <button type="submit" class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 rounded-lg font-semibold hover:from-blue-700 hover:to-purple-700 transition duration-200 shadow-lg">
                    Start 30-Day Free Trial
                </button>
            </form>
            <p class="text-center mt-6 text-sm text-gray-600">
                Already have an account? 
                <button onclick="showLoginForm()" class="text-blue-600 hover:text-blue-700 font-semibold">Sign In</button>
            </p>
        </div>
        
        <p class="text-center text-gray-500 text-xs mt-8">¬© 2024 Workly. All rights reserved.</p>
    </div>
</div>

<!-- ==================== MAIN APP ==================== -->
<div id="mainApp" class="hidden">
    <!-- Mobile Menu Button -->
    <button id="mobileMenuBtn" class="md:hidden fixed top-4 left-4 z-50 bg-blue-600 text-white p-3 rounded-lg shadow-lg hover:bg-blue-700 transition">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
    </button>

    <!-- Sidebar -->
    <aside id="sidebar" class="sidebar fixed left-0 top-0 h-full w-64 bg-white shadow-xl z-40 overflow-y-auto">
        <div class="p-6 border-b border-gray-200 bg-gradient-to-r from-blue-600 to-purple-600">
            <div class="flex items-center gap-3">
                <div class="bg-white rounded-full p-2">
                    <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                    </svg>
                </div>
                <div>
                    <h1 class="text-xl font-bold text-white">Workly</h1>
                    <p class="text-xs text-blue-100" id="userRoleDisplay">Loading...</p>
                </div>
            </div>
        </div>
        <nav class="p-4" id="sidebarNav">
            <!-- Navigation populated by JS -->
        </nav>
        <div class="absolute bottom-0 w-full p-4 border-t border-gray-200 bg-gray-50">
            <div class="mb-3 p-3 bg-white rounded-lg border border-gray-200">
                <p class="text-xs text-gray-600 mb-1">Logged in as:</p>
                <p class="text-sm font-semibold text-gray-800 truncate" id="currentUserName">User</p>
                <p class="text-xs text-gray-500 truncate" id="currentUserEmail">user@email.com</p>
            </div>
            <button id="logoutBtn" class="w-full bg-red-500 text-white py-2 rounded-lg hover:bg-red-600 transition font-semibold">
                Logout
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="md:ml-64 min-h-screen bg-gray-50 pb-20">
        <div class="p-4 md:p-8">
            
            <!-- ==================== DASHBOARD VIEW ==================== -->
            <div id="dashboardView" class="view">
                <div class="mb-6">
                    <h2 class="text-3xl font-bold text-gray-800">Dashboard</h2>
                    <p class="text-gray-600 mt-1">Welcome back! Here's your overview.</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8" id="statsContainer">
                    <!-- Stats populated by JS -->
                </div>
            </div>

            <!-- ==================== EMPLOYEES VIEW ==================== -->
            <div id="employeesView" class="view hidden">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h2 class="text-3xl font-bold text-gray-800">Employees</h2>
                        <p class="text-gray-600 mt-1">Manage your team members</p>
                    </div>
                    <button id="addEmployeeBtn" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition font-semibold shadow-lg">
                        + Add Employee
                    </button>
                </div>
                <div class="bg-white rounded-xl shadow-md overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="min-w-full">
                            <thead class="bg-gray-50 border-b border-gray-200">
                                <tr>
                                    <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700">Name</th>
                                    <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700">Email</th>
                                    <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700">Designation</th>
                                    <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700">Salary</th>
                                    <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700">Status</th>
                                    <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="employeesTableBody">
                                <tr>
                                    <td colspan="6" class="px-6 py-8 text-center text-gray-500">
                                        <div class="loading mx-auto"></div>
                                        <p class="mt-4">Loading employees...</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- ==================== ATTENDANCE VIEW ==================== -->
            <div id="attendanceView" class="view hidden">
                <div class="mb-6">
                    <h2 class="text-3xl font-bold text-gray-800">Attendance</h2>
                    <p class="text-gray-600 mt-1">Track daily attendance</p>
                </div>
                
                <!-- Employee Check-in Section -->
                <div id="employeeCheckInSection" class="hidden mb-6">
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <h3 class="text-xl font-semibold mb-4">Mark Your Attendance</h3>
                        <div class="flex flex-wrap gap-4 mb-4">
                            <button id="checkInBtn" class="bg-green-600 text-white px-8 py-3 rounded-lg hover:bg-green-700 transition font-semibold shadow-lg">
                                ‚úì Check In
                            </button>
                            <button id="checkOutBtn" class="bg-orange-600 text-white px-8 py-3 rounded-lg hover:bg-orange-700 transition font-semibold shadow-lg">
                                ‚Üê Check Out
                            </button>
                        </div>
                        <div id="todayStatusDisplay"></div>
                    </div>
                </div>

                <!-- Admin Mark Attendance -->
                <div id="adminMarkAttendanceSection" class="hidden mb-6">
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <h3 class="text-xl font-semibold mb-4">Mark Attendance (Admin)</h3>
                        <form id="markAttendanceForm" class="grid grid-cols-1 md:grid-cols-5 gap-4">
                            <select id="markAttendanceEmployee" required class="px-4 py-3 border border-gray-300 rounded-lg">
                                <option value="">Select Employee</option>
                            </select>
                            <input type="date" id="markAttendanceDate" required class="px-4 py-3 border border-gray-300 rounded-lg">
                            <select id="markAttendanceStatus" required class="px-4 py-3 border border-gray-300 rounded-lg">
                                <option value="present">Present</option>
                                <option value="absent">Absent</option>
                                <option value="late">Late</option>
                                <option value="half-day">Half Day</option>
                            </select>
                            <input type="time" id="markAttendanceCheckIn" class="px-4 py-3 border border-gray-300 rounded-lg" value="09:00">
                            <button type="submit" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition font-semibold">
                                Mark
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Attendance Records -->
                <div class="bg-white rounded-xl shadow-md p-6">
                    <div class="flex flex-wrap justify-between items-center mb-4 gap-4">
                        <h3 class="text-xl font-semibold">Attendance Records</h3>
                        <div class="flex flex-wrap gap-2">
                            <input type="date" id="filterAttendanceStart" class="px-4 py-2 border border-gray-300 rounded-lg text-sm">
                            <input type="date" id="filterAttendanceEnd" class="px-4 py-2 border border-gray-300 rounded-lg text-sm">
                            <button id="filterAttendanceBtn" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition text-sm font-semibold">
                                Filter
                            </button>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full">
                            <thead class="bg-gray-50 border-b">
                                <tr>
                                    <th class="px-6 py-3 text-left text-sm font-semibold text-gray-700">Employee</th>
                                    <th class="px-6 py-3 text-left text-sm font-semibold text-gray-700">Date</th>
                                    <th class="px-6 py-3 text-left text-sm font-semibold text-gray-700">Check In</th>
                                    <th class="px-6 py-3 text-left text-sm font-semibold text-gray-700">Check Out</th>
                                    <th class="px-6 py-3 text-left text-sm font-semibold text-gray-700">Status</th>
                                    <th class="px-6 py-3 text-left text-sm font-semibold text-gray-700">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="attendanceTableBody">
                                <tr>
                                    <td colspan="6" class="px-6 py-8 text-center text-gray-500">Loading...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- ==================== PAYROLL VIEW ==================== -->
            <div id="payrollView" class="view hidden">
                <div class="flex flex-wrap justify-between items-center mb-6 gap-4">
                    <div>
                        <h2 class="text-3xl font-bold text-gray-800">Payroll</h2>
                        <p class="text-gray-600 mt-1">Manage employee salaries</p>
                    </div>
                    <button id="generatePayrollBtn" class="hidden bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition font-semibold shadow-lg">
                        Generate Payroll
                    </button>
                </div>
                <div id="payrollContent">
                    <!-- Payroll content populated by JS -->
                </div>
            </div>

            <!-- ==================== LEAVES VIEW ==================== -->
            <div id="leavesView" class="view hidden">
                <div class="mb-6">
                    <h2 class="text-3xl font-bold text-gray-800">Leave Management</h2>
                    <p class="text-gray-600 mt-1">Manage leave requests</p>
                </div>
                
                <!-- Apply Leave Form (Employee) -->
                <div id="applyLeaveSection" class="hidden mb-6">
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <h3 class="text-xl font-semibold mb-4">Apply for Leave</h3>
                        <form id="applyLeaveForm" class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Start Date</label>
                                    <input type="date" id="leaveStartDate" required class="w-full px-4 py-3 border border-gray-300 rounded-lg">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">End Date</label>
                                    <input type="date" id="leaveEndDate" required class="w-full px-4 py-3 border border-gray-300 rounded-lg">
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Leave Type</label>
                                <select id="leaveType" required class="w-full px-4 py-3 border border-gray-300 rounded-lg">
                                    <option value="sick">Sick Leave</option>
                                    <option value="casual">Casual Leave</option>
                                    <option value="annual">Annual Leave</option>
                                    <option value="unpaid">Unpaid Leave</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Reason</label>
                                <textarea id="leaveReason" required rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-lg"></textarea>
                            </div>
                            <button type="submit" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition font-semibold">
                                Submit Leave Request
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Leave Requests Table -->
                <div class="bg-white rounded-xl shadow-md overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="min-w-full">
                            <thead class="bg-gray-50 border-b">
                                <tr>
                                    <th class="px-6 py-3 text-left text-sm font-semibold text-gray-700">Employee</th>
                                    <th class="px-6 py-3 text-left text-sm font-semibold text-gray-700">Start Date</th>
                                    <th class="px-6 py-3 text-left text-sm font-semibold text-gray-700">End Date</th>
                                    <th class="px-6 py-3 text-left text-sm font-semibold text-gray-700">Type</th>
                                    <th class="px-6 py-3 text-left text-sm font-semibold text-gray-700">Reason</th>
                                    <th class="px-6 py-3 text-left text-sm font-semibold text-gray-700">Status</th>
                                    <th class="px-6 py-3 text-left text-sm font-semibold text-gray-700">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="leavesTableBody">
                                <tr>
                                    <td colspan="7" class="px-6 py-8 text-center text-gray-500">Loading...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

        </div>
    </main>
</div>

<!-- ==================== MODALS ==================== -->

<!-- Employee Modal -->
<div id="employeeModal" class="hidden fixed inset-0 z-50 overflow-y-auto">
    <div class="flex items-center justify-center min-h-screen p-4">
        <div class="modal-backdrop fixed inset-0" onclick="closeEmployeeModal()"></div>
        <div class="bg-white rounded-xl shadow-2xl z-10 w-full max-w-2xl p-6 relative fade-in">
            <h3 class="text-2xl font-bold mb-6" id="employeeModalTitle">Add Employee</h3>
            <form id="employeeForm" class="space-y-4">
                <input type="hidden" id="employeeId">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Full Name *</label>
                        <input type="text" id="employeeName" required class="w-full px-4 py-3 border border-gray-300 rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Email *</label>
                        <input type="email" id="employeeEmail" required class="w-full px-4 py-3 border border-gray-300 rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Phone</label>
                        <input type="tel" id="employeePhone" class="w-full px-4 py-3 border border-gray-300 rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Designation *</label>
                        <input type="text" id="employeeDesignation" required class="w-full px-4 py-3 border border-gray-300 rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Monthly Salary (Rs.) *</label>
                        <input type="number" id="employeeSalary" required class="w-full px-4 py-3 border border-gray-300 rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Join Date *</label>
                        <input type="date" id="employeeJoinDate" required class="w-full px-4 py-3 border border-gray-300 rounded-lg">
                    </div>
                    <div id="passwordField">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Password *</label>
                        <input type="password" id="employeePassword" class="w-full px-4 py-3 border border-gray-300 rounded-lg" minlength="6">
                        <p class="text-xs text-gray-500 mt-1">Minimum 6 characters</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Role</label>
                        <select id="employeeRole" class="w-full px-4 py-3 border border-gray-300 rounded-lg">
                            <option value="employee">Employee</option>
                            <option value="admin">Admin</option>
                        </select>
                    </div>
                </div>
                <div class="flex gap-4 mt-6">
                    <button type="submit" class="flex-1 bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition font-semibold">
                        Save Employee
                    </button>
                    <button type="button" onclick="closeEmployeeModal()" class="flex-1 bg-gray-300 text-gray-700 px-6 py-3 rounded-lg hover:bg-gray-400 transition font-semibold">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Generate Payroll Modal -->
<div id="generatePayrollModal" class="hidden fixed inset-0 z-50 overflow-y-auto">
    <div class="flex items-center justify-center min-h-screen p-4">
        <div class="modal-backdrop fixed inset-0" onclick="closeGeneratePayrollModal()"></div>
        <div class="bg-white rounded-xl shadow-2xl z-10 w-full max-w-md p-6 relative fade-in">
            <h3 class="text-xl font-bold mb-4">Generate Monthly Payroll</h3>
            <form id="generatePayrollForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Select Month</label>
                    <input type="month" id="payrollMonth" required class="w-full px-4 py-3 border border-gray-300 rounded-lg">
                </div>
                <p class="text-sm text-gray-600">This will generate payroll for all active employees based on their attendance records.</p>
                <div class="flex gap-4">
                    <button type="submit" class="flex-1 bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition font-semibold">
                        Generate
                    </button>
                    <button type="button" onclick="closeGeneratePayrollModal()" class="flex-1 bg-gray-300 text-gray-700 px-6 py-3 rounded-lg hover:bg-gray-400 transition font-semibold">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
// ==================== CONFIGURATION ====================
const CONFIG = {
    API_URL: 'http://localhost:5000/api', // CHANGE THIS TO YOUR DEPLOYED BACKEND URL
    TOKEN_KEY: 'workly_auth_token',
    USER_KEY: 'workly_user_data'
};

let currentUser = null;
let authToken = null;

// ==================== API CLIENT ====================
const api = {
    async request(endpoint, options = {}) {
        const url = `${CONFIG.API_URL}${endpoint}`;
        const headers = {
            'Content-Type': 'application/json',
            ...(authToken && { 'Authorization': `Bearer ${authToken}` })
        };

        try {
            const response = await fetch(url, {
                ...options,
                headers: { ...headers, ...options.headers }
            });

            const data = await response.json();

            if (!response.ok) {
                throw new Error(data.message || 'Request failed');
            }

            return data;
        } catch (error) {
            console.error('API Error:', error);
            throw error;
        }
    },

    // Auth
    login: (email, password) => api.request('/auth/login', {
        method: 'POST',
        body: JSON.stringify({ email, password })
    }),
    register: (data) => api.request('/auth/register', {
        method: 'POST',
        body: JSON.stringify(data)
    }),

    // Employees
    getEmployees: () => api.request('/employees'),
    createEmployee: (data) => api.request('/employees', {
        method: 'POST',
        body: JSON.stringify(data)
    }),
    updateEmployee: (id, data) => api.request(`/employees/${id}`, {
        method: 'PUT',
        body: JSON.stringify(data)
    }),
    deleteEmployee: (id) => api.request(`/employees/${id}`, { method: 'DELETE' }),

    // Attendance
    getAttendance: (params = {}) => api.request(`/attendance?${new URLSearchParams(params)}`),
    checkIn: () => api.request('/attendance/checkin', { method: 'POST' }),
    checkOut: () => api.request('/attendance/checkout', { method: 'POST' }),
    getTodayStatus: () => api.request('/attendance/today/status'),
    markAttendance: (data) => api.request('/attendance', {
        method: 'POST',
        body: JSON.stringify(data)
    }),
    deleteAttendance: (id) => api.request(`/attendance/${id}`, { method: 'DELETE' }),

    // Payroll
    getPayroll: (params = {}) => api.request(`/payroll?${new URLSearchParams(params)}`),
    generatePayroll: (month) => api.request('/payroll/generate', {
        method: 'POST',
        body: JSON.stringify({ month })
    }),
    updatePayrollStatus: (id, status) => api.request(`/payroll/${id}/status`, {
        method: 'PUT',
        body: JSON.stringify({ status })
    }),

    // Leaves
    getLeaves: (params = {}) => api.request(`/leaves?${new URLSearchParams(params)}`),
    applyLeave: (data) => api.request('/leaves', {
        method: 'POST',
        body: JSON.stringify(data)
    }),
    approveLeave: (id) => api.request(`/leaves/${id}/approve`, { method: 'PUT' }),
    rejectLeave: (id) => api.request(`/leaves/${id}/reject`, { method: 'PUT' }),

    // Reports
    getDashboard: () => api.request('/reports/dashboard')
};

// ==================== UI UTILITIES ====================
function showToast(message, type = 'success') {
    const toast = document.createElement('div');
    const bgColor = type === 'success' ? 'bg-green-500' : 'bg-red-500';
    toast.className = `${bgColor} text-white px-6 py-4 rounded-lg shadow-lg mb-4 fade-in flex items-center gap-3`;
    toast.innerHTML = `
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${type === 'success' ? 'M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z' : 'M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z'}"></path>
        </svg>
        <span>${message}</span>
    `;
    document.getElementById('toastContainer').appendChild(toast);
    setTimeout(() => toast.remove(), 4000);
}

function showLoading() {
    document.getElementById('loadingOverlay').classList.remove('hidden');
}

function hideLoading() {
    document.getElementById('loadingOverlay').classList.add('hidden');
}

function formatCurrency(amount) {
    return 'Rs. ' + parseInt(amount).toLocaleString();
}

function formatDate(dateStr) {
    return new Date(dateStr).toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'short',
        day: 'numeric'
    });
}

function getStatusBadge(status) {
    const badges = {
        'present': 'bg-green-100 text-green-800',
        'absent': 'bg-red-100 text-red-800',
        'late': 'bg-yellow-100 text-yellow-800',
        'half-day': 'bg-blue-100 text-blue-800',
        'pending': 'bg-yellow-100 text-yellow-800',
        'approved': 'bg-green-100 text-green-800',
        'rejected': 'bg-red-100 text-red-800',
        'paid': 'bg-green-100 text-green-800',
        'active': 'bg-green-100 text-green-800',
        'inactive': 'bg-gray-100 text-gray-800'
    };
    return badges[status] || 'bg-gray-100 text-gray-800';
}

// ==================== AUTH ====================
function showLoginForm() {
    document.getElementById('loginFormContainer').classList.remove('hidden');
    document.getElementById('registerFormContainer').classList.add('hidden');
}

function showRegisterForm() {
    document.getElementById('loginFormContainer').classList.add('hidden');
    document.getElementById('registerFormContainer').classList.remove('hidden');
}

document.getElementById('loginForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const email = document.getElementById('loginEmail').value;
    const password = document.getElementById('loginPassword').value;
    
    try {
        showLoading();
        const response = await api.login(email, password);
        
        authToken = response.data.token;
        currentUser = response.data.user;
        
        localStorage.setItem(CONFIG.TOKEN_KEY, authToken);
        localStorage.setItem(CONFIG.USER_KEY, JSON.stringify(currentUser));
        
        document.getElementById('authScreen').classList.add('hidden');
        document.getElementById('mainApp').classList.remove('hidden');
        
        initializeApp();
        showToast(`Welcome back, ${currentUser.name}!`);
    } catch (error) {
        showToast(error.message, 'error');
    } finally {
        hideLoading();
    }
});

document.getElementById('registerForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const data = {
        companyName: document.getElementById('regCompanyName').value,
        companyEmail: document.getElementById('regCompanyEmail').value,
        adminName: document.getElementById('regAdminName').value,
        adminEmail: document.getElementById('regAdminEmail').value,
        password: document.getElementById('regPassword').value
    };
    
    try {
        showLoading();
        const response = await api.register(data);
        
        authToken = response.data.token;
        currentUser = response.data.user;
        
        localStorage.setItem(CONFIG.TOKEN_KEY, authToken);
        localStorage.setItem(CONFIG.USER_KEY, JSON.stringify(currentUser));
        
        document.getElementById('authScreen').classList.add('hidden');
        document.getElementById('mainApp').classList.remove('hidden');
        
        initializeApp();
        showToast('Company registered successfully! Welcome to Workly.');
    } catch (error) {
        showToast(error.message, 'error');
    } finally {
        hideLoading();
    }
});

document.getElementById('logoutBtn').addEventListener('click', () => {
    localStorage.removeItem(CONFIG.TOKEN_KEY);
    localStorage.removeItem(CONFIG.USER_KEY);
    location.reload();
});

// ==================== APP INITIALIZATION ====================
async function initializeApp() {
    document.getElementById('userRoleDisplay').textContent = currentUser.role.toUpperCase();
    document.getElementById('currentUserName').textContent = currentUser.name;
    document.getElementById('currentUserEmail').textContent = currentUser.email;
    
    buildNavigation();
    await loadDashboard();
    
    // Show appropriate sections based on role
    if (currentUser.role === 'admin') {
        document.getElementById('adminMarkAttendanceSection').classList.remove('hidden');
        document.getElementById('generatePayrollBtn').classList.remove('hidden');
    } else {
        document.getElementById('employeeCheckInSection').classList.remove('hidden');
        document.getElementById('applyLeaveSection').classList.remove('hidden');
    }
}

function buildNavigation() {
    const menuItems = currentUser.role === 'admin' ? [
        { id: 'dashboard', icon: 'üìä', label: 'Dashboard' },
        { id: 'employees', icon: 'üë•', label: 'Employees' },
        { id: 'attendance', icon: 'üìÖ', label: 'Attendance' },
        { id: 'payroll', icon: 'üí∞', label: 'Payroll' },
        { id: 'leaves', icon: 'üìù', label: 'Leaves' }
    ] : [
        { id: 'dashboard', icon: 'üìä', label: 'Dashboard' },
        { id: 'attendance', icon: 'üìÖ', label: 'My Attendance' },
        { id: 'payroll', icon: 'üí∞', label: 'My Payslips' },
        { id: 'leaves', icon: 'üìù', label: 'My Leaves' }
    ];
    
    document.getElementById('sidebarNav').innerHTML = menuItems.map(item => `
        <button class="nav-item w-full text-left px-4 py-3 rounded-lg hover:bg-blue-50 hover:text-blue-600 transition mb-2 flex items-center gap-3" data-view="${item.id}">
            <span class="text-2xl">${item.icon}</span>
            <span class="font-medium">${item.label}</span>
        </button>
    `).join('');
    
    document.querySelectorAll('.nav-item').forEach(btn => {
        btn.addEventListener('click', function() {
            const view = this.getAttribute('data-view');
            showView(view);
            document.getElementById('sidebar').classList.remove('active');
        });
    });
    
    // Set dashboard as active
    document.querySelector('[data-view="dashboard"]').classList.add('active');
}

function showView(viewName) {
    document.querySelectorAll('.view').forEach(v => v.classList.add('hidden'));
    document.getElementById(viewName + 'View').classList.remove('hidden');
    
    document.querySelectorAll('.nav-item').forEach(btn => btn.classList.remove('active'));
    document.querySelector(`[data-view="${viewName}"]`).classList.add('active');
    
    switch(viewName) {
        case 'dashboard': loadDashboard(); break;
        case 'employees': loadEmployees(); break;
        case 'attendance': loadAttendance(); break;
        case 'payroll': loadPayroll(); break;
        case 'leaves': loadLeaves(); break;
    }
}

// ==================== DASHBOARD ====================
async function loadDashboard() {
    try {
        const { data } = await api.getDashboard();
        
        const stats = currentUser.role === 'admin' ? [
            { label: 'Total Employees', value: data.totalEmployees, icon: 'üë•', class: 'stat-card' },
            { label: 'Present Today', value: data.presentToday, icon: '‚úÖ', class: 'stat-card-2' },
            { label: 'Pending Leaves', value: data.pendingLeaves, icon: 'üìù', class: 'stat-card-3' },
            { label: 'Monthly Salary Cost', value: formatCurrency(data.monthlySalaryCost), icon: 'üí∞', class: 'stat-card-4' }
        ] : [
            { label: 'Attendance This Month', value: data.monthlyAttendance + ' days', icon: 'üìÖ', class: 'stat-card' },
            { label: 'Today\'s Status', value: data.todayStatus, icon: '‚úÖ', class: 'stat-card-2' },
            { label: 'Pending Leaves', value: data.pendingLeaves, icon: 'üìù', class: 'stat-card-3' },
            { label: 'Monthly Salary', value: formatCurrency(data.salary), icon: 'üí∞', class: 'stat-card-4' }
        ];
        
        document.getElementById('statsContainer').innerHTML = stats.map(stat => `
            <div class="${stat.class} rounded-xl shadow-lg p-6 text-white transform hover:scale-105 transition">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm opacity-90">${stat.label}</p>
                        <p class="text-3xl font-bold mt-2">${stat.value}</p>
                    </div>
                    <div class="text-5xl opacity-80">${stat.icon}</div>
                </div>
            </div>
        `).join('');
    } catch (error) {
        showToast('Error loading dashboard', 'error');
    }
}

// ==================== EMPLOYEES ====================
async function loadEmployees() {
    try {
        const { data } = await api.getEmployees();
        
        const tbody = document.getElementById('employeesTableBody');
        if (data.length === 0) {
            tbody.innerHTML = '<tr><td colspan="6" class="px-6 py-8 text-center text-gray-500">No employees found. Click "Add Employee" to get started.</td></tr>';
            return;
        }
        
        tbody.innerHTML = data.map(emp => `
            <tr class="border-b hover:bg-gray-50">
                <td class="px-6 py-4">
                    <div class="font-semibold text-gray-800">${emp.name}</div>
                    <div class="text-sm text-gray-500">${emp.designation}</div>
                </td>
                <td class="px-6 py-4 text-gray-700">${emp.email}</td>
                <td class="px-6 py-4 text-gray-700">${emp.designation}</td>
                <td class="px-6 py-4 font-semibold text-gray-800">${formatCurrency(emp.salary)}</td>
                <td class="px-6 py-4">
                    <span class="px-3 py-1 rounded-full text-xs font-semibold ${getStatusBadge(emp.status)}">
                        ${emp.status.toUpperCase()}
                    </span>
                </td>
                <td class="px-6 py-4">
                    <button onclick="editEmployee('${emp._id}')" class="text-blue-600 hover:text-blue-800 mr-3 font-semibold">Edit</button>
                    <button onclick="deleteEmployee('${emp._id}')" class="text-red-600 hover:text-red-800 font-semibold">Delete</button>
                </td>
            </tr>
        `).join('');
    } catch (error) {
        showToast('Error loading employees', 'error');
    }
}

document.getElementById('addEmployeeBtn')?.addEventListener('click', () => {
    document.getElementById('employeeModalTitle').textContent = 'Add New Employee';
    document.getElementById('employeeForm').reset();
    document.getElementById('employeeId').value = '';
    document.getElementById('employeePassword').required = true;
    document.getElementById('employeeJoinDate').valueAsDate = new Date();
    document.getElementById('employeeModal').classList.remove('hidden');
});

document.getElementById('employeeForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const id = document.getElementById('employeeId').value;
    const data = {
        name: document.getElementById('employeeName').value,
        email: document.getElementById('employeeEmail').value,
        phone: document.getElementById('employeePhone').value,
        designation: document.getElementById('employeeDesignation').value,
        salary: parseInt(document.getElementById('employeeSalary').value),
        joinDate: document.getElementById('employeeJoinDate').value,
        role: document.getElementById('employeeRole').value,
        password: document.getElementById('employeePassword').value
    };
    
    try {
        showLoading();
        if (id) {
            await api.updateEmployee(id, data);
            showToast('Employee updated successfully');
        } else {
            await api.createEmployee(data);
            showToast('Employee added successfully');
        }
        closeEmployeeModal();
        loadEmployees();
    } catch (error) {
        showToast(error.message, 'error');
    } finally {
        hideLoading();
    }
});

async function editEmployee(id) {
    try {
        const { data: employees } = await api.getEmployees();
        const employee = employees.find(e => e._id === id);
        
        if (employee) {
            document.getElementById('employeeModalTitle').textContent = 'Edit Employee';
            document.getElementById('employeeId').value = employee._id;
            document.getElementById('employeeName').value = employee.name;
            document.getElementById('employeeEmail').value = employee.email;
            document.getElementById('employeePhone').value = employee.phone || '';
            document.getElementById('employeeDesignation').value = employee.designation;
            document.getElementById('employeeSalary').value = employee.salary;
            document.getElementById('employeeJoinDate').value = employee.joinDate.split('T')[0];
            document.getElementById('employeeRole').value = employee.role;
            document.getElementById('employeePassword').required = false;
            document.getElementById('employeePassword').value = '';
            
            document.getElementById('employeeModal').classList.remove('hidden');
        }
    } catch (error) {
        showToast('Error loading employee data', 'error');
    }
}

async function deleteEmployee(id) {
    if (!confirm('Are you sure you want to delete this employee? This will also delete their attendance and payroll records.')) return;
    
    try {
        showLoading();
        await api.deleteEmployee(id);
        showToast('Employee deleted successfully');
        loadEmployees();
    } catch (error) {
        showToast(error.message, 'error');
    } finally {
        hideLoading();
    }
}

function closeEmployeeModal() {
    document.getElementById('employeeModal').classList.add('hidden');
}

// ==================== ATTENDANCE ====================
async function loadAttendance() {
    try {
        const { data } = await api.getAttendance();
        
        const tbody = document.getElementById('attendanceTableBody');
        if (data.length === 0) {
            tbody.innerHTML = '<tr><td colspan="6" class="px-6 py-8 text-center text-gray-500">No attendance records found.</td></tr>';
            return;
        }
        
        tbody.innerHTML = data.map(att => `
            <tr class="border-b hover:bg-gray-50">
                <td class="px-6 py-4 font-semibold text-gray-800">${att.employee.name}</td>
                <td class="px-6 py-4 text-gray-700">${formatDate(att.date)}</td>
                <td class="px-6 py-4 text-gray-700">${att.checkInTime || '-'}</td>
                <td class="px-6 py-4 text-gray-700">${att.checkOutTime || '-'}</td>
                <td class="px-6 py-4">
                    <span class="px-3 py-1 rounded-full text-xs font-semibold ${getStatusBadge(att.status)}">
                        ${att.status.toUpperCase()}
                    </span>
                </td>
                <td class="px-6 py-4">
                    ${currentUser.role === 'admin' ? `
                        <button onclick="deleteAttendanceRecord('${att._id}')" class="text-red-600 hover:text-red-800 font-semibold">Delete</button>
                    ` : '-'}
                </td>
            </tr>
        `).join('');
        
        if (currentUser.role === 'employee') {
            updateTodayStatus();
        } else {
            populateEmployeeDropdowns();
        }
    } catch (error) {
        showToast('Error loading attendance', 'error');
    }
}

async function updateTodayStatus() {
    try {
        const { data } = await api.getTodayStatus();
        const display = document.getElementById('todayStatusDisplay');
        
        if (data) {
            display.innerHTML = `
                <div class="p-4 bg-green-50 border border-green-200 rounded-lg">
                    <p class="text-green-800 font-semibold">‚úì Attendance Marked for Today</p>
                    <p class="text-green-700 text-sm mt-1">Status: ${data.status.toUpperCase()} | Check In: ${data.checkInTime} | Check Out: ${data.checkOutTime || 'Not yet'}</p>
                </div>
            `;
            document.getElementById('checkInBtn').disabled = true;
            document.getElementById('checkInBtn').classList.add('opacity-50', 'cursor-not-allowed');
        } else {
            display.innerHTML = `
                <div class="p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                    <p class="text-yellow-800 font-semibold">‚ö† You haven't marked attendance today</p>
                </div>
            `;
        }
    } catch (error) {
        console.error('Error fetching today status:', error);
    }
}

document.getElementById('checkInBtn')?.addEventListener('click', async () => {
    try {
        showLoading();
        await api.checkIn();
        showToast('Checked in successfully!');
        loadAttendance();
    } catch (error) {
        showToast(error.message, 'error');
    } finally {
        hideLoading();
    }
});

document.getElementById('checkOutBtn')?.addEventListener('click', async () => {
    try {
        showLoading();
        await api.checkOut();
        showToast('Checked out successfully!');
        loadAttendance();
    } catch (error) {
        showToast(error.message, 'error');
    } finally {
        hideLoading();
    }
});

document.getElementById('markAttendanceForm')?.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const data = {
        employeeId: document.getElementById('markAttendanceEmployee').value,
        date: document.getElementById('markAttendanceDate').value,
        status: document.getElementById('markAttendanceStatus').value,
        checkInTime: document.getElementById('markAttendanceCheckIn').value
    };
    
    try {
        showLoading();
        await api.markAttendance(data);
        showToast('Attendance marked successfully');
        e.target.reset();
        loadAttendance();
    } catch (error) {
        showToast(error.message, 'error');
    } finally {
        hideLoading();
    }
});

async function deleteAttendanceRecord(id) {
    if (!confirm('Delete this attendance record?')) return;
    
    try {
        showLoading();
        await api.deleteAttendance(id);
        showToast('Attendance record deleted');
        loadAttendance();
    } catch (error) {
        showToast(error.message, 'error');
    } finally {
        hideLoading();
    }
}

async function populateEmployeeDropdowns() {
    try {
        const { data } = await api.getEmployees();
        const options = data.map(emp => `<option value="${emp._id}">${emp.name}</option>`).join('');
        
        const select = document.getElementById('markAttendanceEmployee');
        if (select) {
            select.innerHTML = '<option value="">Select Employee</option>' + options;
        }
    } catch (error) {
        console.error('Error populating dropdowns:', error);
    }
}

// ==================== PAYROLL ====================
async function loadPayroll() {
    try {
        const { data } = await api.getPayroll();
        const content = document.getElementById('payrollContent');
        
        if (currentUser.role === 'admin') {
            if (data.length === 0) {
                content.innerHTML = `
                    <div class="bg-white rounded-xl shadow-md p-12 text-center">
                        <div class="text-6xl mb-4">üí∞</div>
                        <h3 class="text-xl font-semibold mb-2">No Payroll Generated Yet</h3>
                        <p class="text-gray-600 mb-6">Click "Generate Payroll" to create monthly salary records</p>
                    </div>
                `;
                return;
            }
            
            content.innerHTML = `
                <div class="bg-white rounded-xl shadow-md overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="min-w-full">
                            <thead class="bg-gray-50 border-b">
                                <tr>
                                    <th class="px-6 py-3 text-left text-sm font-semibold text-gray-700">Employee</th>
                                    <th class="px-6 py-3 text-left text-sm font-semibold text-gray-700">Month</th>
                                    <th class="px-6 py-3 text-left text-sm font-semibold text-gray-700">Days</th>
                                    <th class="px-6 py-3 text-left text-sm font-semibold text-gray-700">Deductions</th>
                                    <th class="px-6 py-3 text-left text-sm font-semibold text-gray-700">Total Salary</th>
                                    <th class="px-6 py-3 text-left text-sm font-semibold text-gray-700">Status</th>
                                    <th class="px-6 py-3 text-left text-sm font-semibold text-gray-700">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.map(pay => `
                                    <tr class="border-b hover:bg-gray-50">
                                        <td class="px-6 py-4 font-semibold text-gray-800">${pay.employee.name}</td>
                                        <td class="px-6 py-4 text-gray-700">${pay.month}</td>
                                        <td class="px-6 py-4 text-gray-700">${pay.daysPresent}/${pay.totalDays}</td>
                                        <td class="px-6 py-4 text-red-600">${formatCurrency(pay.deductions)}</td>
                                        <td class="px-6 py-4 font-bold text-green-600">${formatCurrency(pay.totalSalary)}</td>
                                        <td class="px-6 py-4">
                                            <span class="px-3 py-1 rounded-full text-xs font-semibold ${getStatusBadge(pay.status)}">
                                                ${pay.status.toUpperCase()}
                                            </span>
                                        </td>
                                        <td class="px-6 py-4">
                                            <button onclick="downloadPayslip('${pay._id}')" class="text-blue-600 hover:text-blue-800 mr-3 font-semibold">PDF</button>
                                            <button onclick="togglePayrollStatus('${pay._id}', '${pay.status}')" class="text-green-600 hover:text-green-800 font-semibold">
                                                ${pay.status === 'paid' ? 'Unpaid' : 'Mark Paid'}
                                            </button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        } else {
            if (data.length === 0) {
                content.innerHTML = `
                    <div class="bg-white rounded-xl shadow-md p-12 text-center">
                        <div class="text-6xl mb-4">üìÑ</div>
                        <h3 class="text-xl font-semibold mb-2">No Payslips Available</h3>
                        <p class="text-gray-600">Your payslips will appear here once generated by admin</p>
                    </div>
                `;
                return;
            }
            
            content.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    ${data.map(pay => `
                        <div class="bg-white rounded-xl shadow-md p-6 border border-gray-200 hover:shadow-lg transition">
                            <div class="flex justify-between items-start mb-4">
                                <div>
                                    <h3 class="text-xl font-bold text-gray-800">${pay.month}</h3>
                                    <p class="text-gray-600 text-sm">Payslip</p>
                                </div>
                                <span class="px-3 py-1 rounded-full text-xs font-semibold ${getStatusBadge(pay.status)}">
                                    ${pay.status.toUpperCase()}
                                </span>
                            </div>
                            <div class="space-y-2 mb-4">
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600">Days Present:</span>
                                    <span class="font-semibold">${pay.daysPresent}/${pay.totalDays}</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600">Basic Salary:</span>
                                    <span class="font-semibold">${formatCurrency(pay.basicSalary)}</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600">Deductions:</span>
                                    <span class="font-semibold text-red-600">-${formatCurrency(pay.deductions)}</span>
                                </div>
                                <hr class="my-2">
                                <div class="flex justify-between">
                                    <span class="font-bold text-gray-800">Total Salary:</span>
                                    <span class="font-bold text-green-600 text-lg">${formatCurrency(pay.totalSalary)}</span>
                                </div>
                            </div>
                            <button onclick="downloadPayslip('${pay._id}')" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition font-semibold">
                                Download PDF
                            </button>
                        </div>
                    `).join('')}
                </div>
            `;
        }
    } catch (error) {
        showToast('Error loading payroll', 'error');
    }
}

document.getElementById('generatePayrollBtn')?.addEventListener('click', () => {
    const today = new Date();
    const month = today.toISOString().substring(0, 7);
    document.getElementById('payrollMonth').value = month;
    document.getElementById('generatePayrollModal').classList.remove('hidden');
});

document.getElementById('generatePayrollForm')?.addEventListener('submit', async (e) => {
    e.preventDefault();
    const month = document.getElementById('payrollMonth').value;
    
    try {
        showLoading();
        const result = await api.generatePayroll(month);
        showToast(result.message);
        closeGeneratePayrollModal();
        loadPayroll();
    } catch (error) {
        showToast(error.message, 'error');
    } finally {
        hideLoading();
    }
});

async function togglePayrollStatus(id, currentStatus) {
    const newStatus = currentStatus === 'paid' ? 'pending' : 'paid';
    
    try {
        showLoading();
        await api.updatePayrollStatus(id, newStatus);
        showToast(`Payroll marked as ${newStatus}`);
        loadPayroll();
    } catch (error) {
        showToast(error.message, 'error');
    } finally {
        hideLoading();
    }
}

function downloadPayslip(payrollId) {
    // Basic PDF generation - you can enhance this
    showToast('PDF generation feature - Use browser print (Ctrl+P) for now', 'error');
    // In production, implement proper PDF generation using jsPDF with payroll data
}

function closeGeneratePayrollModal() {
    document.getElementById('generatePayrollModal').classList.add('hidden');
}

// ==================== LEAVES ====================
async function loadLeaves() {
    try {
        const { data } = await api.getLeaves();
        
        const tbody = document.getElementById('leavesTableBody');
        if (data.length === 0) {
            tbody.innerHTML = '<tr><td colspan="7" class="px-6 py-8 text-center text-gray-500">No leave requests found.</td></tr>';
            return;
        }
        
        tbody.innerHTML = data.map(leave => `
            <tr class="border-b hover:bg-gray-50">
                <td class="px-6 py-4 font-semibold text-gray-800">${leave.employee.name}</td>
                <td class="px-6 py-4 text-gray-700">${formatDate(leave.startDate)}</td>
                <td class="px-6 py-4 text-gray-700">${formatDate(leave.endDate)}</td>
                <td class="px-6 py-4">
                    <span class="px-3 py-1 rounded-full text-xs font-semibold bg-blue-100 text-blue-800">
                        ${leave.type.toUpperCase()}
                    </span>
                </td>
                <td class="px-6 py-4 text-gray-700">${leave.reason}</td>
                <td class="px-6 py-4">
                    <span class="px-3 py-1 rounded-full text-xs font-semibold ${getStatusBadge(leave.status)}">
                        ${leave.status.toUpperCase()}
                    </span>
                </td>
                <td class="px-6 py-4">
                    ${currentUser.role === 'admin' && leave.status === 'pending' ? `
                        <button onclick="approveLeaveRequest('${leave._id}')" class="text-green-600 hover:text-green-800 mr-2 font-semibold">Approve</button>
                        <button onclick="rejectLeaveRequest('${leave._id}')" class="text-red-600 hover:text-red-800 font-semibold">Reject</button>
                    ` : '-'}
                </td>
            </tr>
        `).join('');
    } catch (error) {
        showToast('Error loading leaves', 'error');
    }
}

document.getElementById('applyLeaveForm')?.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const data = {
        startDate: document.getElementById('leaveStartDate').value,
        endDate: document.getElementById('leaveEndDate').value,
        type: document.getElementById('leaveType').value,
        reason: document.getElementById('leaveReason').value
    };
    
    try {
        showLoading();
        await api.applyLeave(data);
        showToast('Leave request submitted successfully');
        e.target.reset();
        loadLeaves();
    } catch (error) {
        showToast(error.message, 'error');
    } finally {
        hideLoading();
    }
});

async function approveLeaveRequest(id) {
    try {
        showLoading();
        await api.approveLeave(id);
        showToast('Leave request approved');
        loadLeaves();
    } catch (error) {
        showToast(error.message, 'error');
    } finally {
        hideLoading();
    }
}

async function rejectLeaveRequest(id) {
    try {
        showLoading();
        await api.rejectLeave(id);
        showToast('Leave request rejected');
        loadLeaves();
    } catch (error) {
        showToast(error.message, 'error');
    } finally {
        hideLoading();
    }
}

// ==================== MOBILE MENU ====================
document.getElementById('mobileMenuBtn').addEventListener('click', () => {
    document.getElementById('sidebar').classList.toggle('active');
});

// ==================== INITIALIZATION ====================
window.addEventListener('DOMContentLoaded', () => {
    const token = localStorage.getItem(CONFIG.TOKEN_KEY);
    const user = localStorage.getItem(CONFIG.USER_KEY);
    
    if (token && user) {
        authToken = token;
        currentUser = JSON.parse(user);
        
        document.getElementById('authScreen').classList.add('hidden');
        document.getElementById('mainApp').classList.remove('hidden');
        
        initializeApp();
    }
    
    // Set today's date as default
    const today = new Date().toISOString().split('T')[0];
    const dateInputs = document.querySelectorAll('input[type="date"]');
    dateInputs.forEach(input => {
        if (!input.value) input.value = today;
    });
});
</script>

</body>
</html>